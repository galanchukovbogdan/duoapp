<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä: –ë–∏—Ç–≤–∞ –°—Ç—Ä–∞—Ç–µ–≥–∏–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- –°–∫—Ä–∏–ø—Ç Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Custom Chart Container Styles */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* Hide scrollbar for clean horizontal scrolling if needed internally */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body {
            background-color: #f5f5f4; /* stone-100 */
            color: #44403c; /* stone-700 */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .accent-bg {
            background-color: #d97706; /* amber-600 */
        }
        .accent-text {
            color: #d97706;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Table Styles */
        .sim-table th {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #78716c;
            font-weight: 600;
            padding: 0.5rem;
        }
        .sim-table td {
            padding: 0.25rem;
        }
        .rank-select {
            width: 100%;
            min-width: 40px;
            padding: 2px;
            font-size: 0.875rem;
            border-radius: 0.25rem;
            border: 1px solid #d6d3d1;
            background-color: #fff;
            text-align: center;
        }
        .rank-select:focus {
            outline: none;
            border-color: #d97706;
        }
        /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-sm border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center">
                    <span class="font-bold text-xl tracking-tight text-stone-800">üèÜ [–¢–£–†–ù–ò–†]</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <!-- –Ø–ö–û–†–Ø –í –ú–ï–ù–Æ (–†–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é scrollToSection) -->
                    <button onclick="scrollToSection('about')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–û —Ç—É—Ä–Ω–∏—Ä–µ</button>
                    <button onclick="scrollToSection('format')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–§–æ—Ä–º–∞—Ç</button>
                    <button onclick="scrollToSection('scoring')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–†–µ–π—Ç–∏–Ω–≥</button>
                    <button onclick="scrollToSection('join')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–£—á–∞—Å—Ç–∏–µ</button>
                </div>
                <button onclick="scrollToSection('join')" class="accent-bg text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-amber-700 transition-colors shadow-md">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-stone-900 text-stone-50 overflow-hidden">
        <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <div class="relative max-w-5xl mx-auto px-4 py-24 sm:px-6 lg:px-8 flex flex-col items-center text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-6">
                –î–æ–∫–∞–∂–∏—Ç–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –≤ <span class="text-amber-500">[–¢–£–†–ù–ò–†]</span>
            </h1>
            <p class="mt-4 max-w-2xl text-xl text-stone-300">
                –ë–∏—Ç–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∏ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ –¥—É—Ö–∞. –ù–∏–∫–∞–∫–æ–≥–æ —Ö–∞–æ—Å–∞ ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Å—Ç–Ω–∞—è –±–æ—Ä—å–±–∞ –≤ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.
            </p>
            <div class="mt-10 flex flex-col sm:flex-row gap-4">
                <!-- –ö–Ω–æ–ø–∫–∞ –≤–µ–¥–µ—Ç –≤–Ω–∏–∑ –∫ —Å–µ–∫—Ü–∏–∏ "join" -->
                <button onclick="scrollToSection('join')" class="accent-bg text-white px-8 py-4 rounded-xl text-lg font-bold hover:bg-amber-700 transition-all shadow-lg transform hover:scale-105">
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
                </button>
                <button onclick="scrollToSection('about')" class="bg-stone-800 text-stone-200 border border-stone-600 px-8 py-4 rounded-xl text-lg font-medium hover:bg-stone-700 transition-all">
                    –£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
                </button>
            </div>
        </div>
    </header>

    <!-- Interactive Format Section -->
    <section id="format" class="py-16 bg-stone-100 border-y border-stone-200">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-stone-900 mb-4">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π?</h2>
                <p class="text-stone-600 mb-6">
                    –ì–ª–∞–≤–Ω–∞—è ¬´—Ñ–∏—à–∫–∞¬ª ‚Äî –≥–∏–±–∫–æ—Å—Ç—å. –ú—ã –∏–≥—Ä–∞–µ–º 3‚Äì4 —ç—Ç–∞–ø–∞. –í –∫–∞–∂–¥–æ–º —Ä–∞—É–Ω–¥–µ –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–±–±–∏ –∏–∑ 4-—Ö –∫–æ–º–∞–Ω–¥.
                    <br><br>
                    <strong>–ë–æ–∏—Ç–µ—Å—å "–Ω–µ—á–µ—Ç–Ω–æ–≥–æ" –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–∞–Ω–¥?</strong> –ù–µ —Å—Ç–æ–∏—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∏–º—É–ª—è—Ç–æ—Ä –Ω–∏–∂–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —Å–µ—Ç–∫—É –ø–æ–¥ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
                </p>
            </div>
            <!-- Format Visualizer -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                 <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <label for="team-count" class="font-bold text-stone-700 mr-4 mb-2 sm:mb-0">
                        –°–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å?
                    </label>
                    <select id="team-count" class="bg-stone-50 border border-stone-300 text-stone-900 text-sm rounded-lg focus:ring-amber-500 focus:border-amber-500 block p-2.5">
                        <option value="16" selected>16 –ö–æ–º–∞–Ω–¥ (–ü–æ–ª–Ω–∞—è —Å–µ—Ç–∫–∞)</option>
                        <option value="12">12 –ö–æ–º–∞–Ω–¥</option>
                        <option value="10">10 –ö–æ–º–∞–Ω–¥</option>
                        <option value="8">8 –ö–æ–º–∞–Ω–¥</option>
                    </select>
                </div>
                <div id="lobby-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 transition-all duration-500 ease-in-out">
                    <!-- Dynamic Content will appear here -->
                </div>
                <div id="format-explanation" class="mt-6 p-4 bg-blue-50 text-blue-800 rounded-lg text-sm border border-blue-100 flex items-start">
                    <span class="text-xl mr-3">‚ÑπÔ∏è</span>
                    <p>–¢–µ–∫—Å—Ç –ø–æ—è—Å–Ω–µ–Ω–∏—è...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Scoring Section -->
    <section id="scoring" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-stone-900">–°–∏–º—É–ª—è—Ç–æ—Ä –†–µ–π—Ç–∏–Ω–≥–∞ (16 –∫–æ–º–∞–Ω–¥)</h2>
                <p class="text-stone-600 max-w-2xl mx-auto">
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–∞ –¥–ª—è –≤—Å–µ—Ö 16 –∫–æ–º–∞–Ω–¥. –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —Ç—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞.
                    <br><span class="text-xs text-stone-400">–î–∞–Ω–Ω—ã–µ: 1 –º–µ—Å—Ç–æ = 4 –æ—á–∫–∞, 2 = 3, 3 = 2, 4 = 1. –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —ç—Ç–∞–ø–æ–≤: x1.0, x1.2, x1.4, x1.6.</span>
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                
                <!-- Table Controls & Input -->
                <div class="lg:col-span-2 bg-stone-50 p-6 rounded-2xl border border-stone-200 shadow-inner overflow-hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg text-stone-800">–í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                        <div class="flex gap-2">
                            <button onclick="randomizeResults()" class="text-xs bg-stone-200 hover:bg-stone-300 text-stone-700 px-3 py-1 rounded transition-colors">
                                üé≤ –°–ª—É—á–∞–π–Ω–æ
                            </button>
                            <button onclick="updateAndSort()" class="text-xs bg-amber-600 hover:bg-amber-700 text-white px-3 py-1 rounded transition-colors shadow-sm">
                                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏ –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left sim-table">
                            <thead>
                                <tr class="border-b border-stone-200">
                                    <th class="w-8">#</th>
                                    <th>–ö–æ–º–∞–Ω–¥–∞</th>
                                    <th class="text-center w-16">–≠—Ç 1<br><span class="text-[10px] opacity-70">x1.0</span></th>
                                    <th class="text-center w-16">–≠—Ç 2<br><span class="text-[10px] opacity-70">x1.2</span></th>
                                    <th class="text-center w-16">–≠—Ç 3<br><span class="text-[10px] opacity-70">x1.4</span></th>
                                    <th class="text-center w-16 text-amber-700 bg-amber-50">–≠—Ç 4<br><span class="text-[10px] opacity-70">x1.6</span></th>
                                    <th class="text-right w-20">–ò—Ç–æ–≥</th>
                                </tr>
                            </thead>
                            <tbody id="teams-table-body" class="text-sm text-stone-700 divide-y divide-stone-100">
                                <!-- Rows generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Chart & Stats -->
                <div class="bg-white p-4 rounded-2xl border border-stone-200 shadow-lg sticky top-24">
                    <h3 class="font-bold text-stone-800 mb-4 text-center">–ì—Ä–∞—Ñ–∏–∫ –õ–∏–¥–µ—Ä–æ–≤</h3>
                    <div class="chart-container">
                        <canvas id="scoringChart"></canvas>
                    </div>
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-100 text-xs text-blue-800">
                        <p><strong>–ò–Ω—Å–∞–π—Ç:</strong> –ü—Ä–∏ –ø–ª–æ—Ç–Ω–æ–π –±–æ—Ä—å–±–µ –ø–æ–±–µ–∂–¥–∞–µ—Ç –Ω–µ —Ç–æ—Ç, –∫—Ç–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞–Ω—è–ª –¢–û–ü-1, –∞ —Ç–æ—Ç, –∫—Ç–æ –∏–∑–±–µ–≥–∞–ª 4-—Ö –º–µ—Å—Ç –Ω–∞ –ø–æ–∑–¥–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Prizes & Join Section (–Ø–ö–û–†–¨ #join) -->
    <section id="join" class="py-16 bg-stone-900 text-stone-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            
            <div class="bg-gradient-to-br from-amber-600 to-amber-700 rounded-3xl p-8 md:p-12 shadow-2xl">
                <h2 class="text-3xl font-bold text-white mb-8">–ì–æ—Ç–æ–≤—ã –ø–æ–±–µ–∂–¥–∞—Ç—å?</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-left mb-10">
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md hover:bg-white/20 transition cursor-pointer">
                        <span class="block text-2xl font-bold opacity-50 mb-1">01</span>
                        <h4 class="font-bold">Discord</h4>
                        <!-- !!! –í–°–¢–ê–í–¨–¢–ï –°–°–´–õ–ö–£ –ù–ê –î–ò–°–ö–û–†–î –ù–ò–ñ–ï (–≤–º–µ—Å—Ç–æ #) !!! -->
                        <a href="#" target="_blank" class="text-xs opacity-80 underline hover:text-white">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</a>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md">
                        <span class="block text-2xl font-bold opacity-50 mb-1">02</span>
                        <h4 class="font-bold">–°–æ—Å—Ç–∞–≤</h4>
                        <p class="text-xs opacity-80">–ù–∞–π–¥–∏—Ç–µ 2-5 –∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–∞–ø–∏—Ç–∞–Ω–∞.</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md">
                        <span class="block text-2xl font-bold opacity-50 mb-1">03</span>
                        <h4 class="font-bold">–ó–∞—è–≤–∫–∞</h4>
                        <p class="text-xs opacity-80">–ö–∞–ø–∏—Ç–∞–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∑–∞ 2 –º–∏–Ω—É—Ç—ã.</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md">
                        <span class="block text-2xl font-bold opacity-50 mb-1">04</span>
                        <h4 class="font-bold">–°—Ç–∞—Ä—Ç</h4>
                        <p class="text-xs opacity-80">–ë—É–¥—å—Ç–µ –æ–Ω–ª–∞–π–Ω –∑–∞ 30 –º–∏–Ω –¥–æ –Ω–∞—á–∞–ª–∞.</p>
                    </div>
                </div>

                <!-- !!! –í–°–¢–ê–í–¨–¢–ï –°–°–´–õ–ö–£ –ù–ê –ì–£–ì–õ –§–û–†–ú–£ –ù–ò–ñ–ï –í –ê–¢–†–ò–ë–£–¢ HREF !!! -->
                <!-- –°–µ–π—á–∞—Å —Å—Ç–æ–∏—Ç –∑–∞–≥–ª—É—à–∫–∞ #, –∑–∞–º–µ–Ω–∏—Ç–µ –µ—ë –Ω–∞ –≤–∞—à—É —Å—Å—ã–ª–∫—É (https://forms.google.com/...) -->
                <a href="#" target="_blank" class="inline-block w-full md:w-auto bg-white text-amber-700 px-8 py-4 rounded-xl text-lg font-bold hover:bg-stone-100 transition-colors shadow-lg transform hover:scale-105">
                    –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—á–∞—Å—Ç–∏–µ
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-8 border-t border-stone-800 mt-auto">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <p class="mb-2">¬© 2023 [–ù–ê–ó–í–ê–ù–ò–ï –¢–£–†–ù–ò–†–ê].</p>
        </div>
    </footer>

    <!-- Logic Script -->
    <script>
        // --- TELEGRAM MINI APP INIT ---
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¢–µ–ª–µ–≥—Ä–∞–º
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready(); // –°–æ–æ–±—â–∞–µ–º –¢–µ–ª–µ–≥—Ä–∞–º—É, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
                tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            }
        });

        // --- Navigation Logic ---
        function scrollToSection(id) {
            const element = document.getElementById(id);
            if (element) { element.scrollIntoView({ behavior: 'smooth' }); }
        }

        // --- Format Visualizer Logic (RESTORED) ---
        const teamSelect = document.getElementById('team-count');
        const lobbyGrid = document.getElementById('lobby-grid');
        const formatExplanation = document.getElementById('format-explanation').querySelector('p');

        function updateLobbyViz() {
            const count = parseInt(teamSelect.value);
            lobbyGrid.innerHTML = '';
            
            // Logic to determine visual representation of lobbies
            let lobbies = [];
            let message = '';

            if (count === 8) {
                lobbies = [4, 4];
                message = "2 –ø–æ–ª–Ω—ã—Ö –ª–æ–±–±–∏. –ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å. –ö–∞–∂–¥—ã–π –∏–≥—Ä–∞–µ—Ç —Å –∫–∞–∂–¥—ã–º –∑–∞ 3-4 —ç—Ç–∞–ø–∞.";
            } else if (count === 10) {
                lobbies = [4, 4, 2];
                message = "10 –∫–æ–º–∞–Ω–¥: –°–µ—Ç–∫–∞ —Ö–∏—Ç—Ä–µ–µ. 2 –ø–æ–ª–Ω—ã—Ö –ª–æ–±–±–∏, –∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–∞—é—Ç –≤ —Ä–æ—Ç–∞—Ü–∏–∏. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—Å—Ç—Ä–µ—Ç—è—Ç—Å—è –¥–≤–∞–∂–¥—ã, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤ —ç—Ç–æ —É—á—Ç–µ—Ç.";
            } else if (count === 12) {
                lobbies = [4, 4, 4];
                message = "12 –∫–æ–º–∞–Ω–¥: 3 –ø–æ–ª–Ω—ã—Ö –ª–æ–±–±–∏. –û—Ç–ª–∏—á–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤.";
            } else if (count === 16) {
                lobbies = [4, 4, 4, 4];
                message = "16 –∫–æ–º–∞–Ω–¥: –ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç. 4 –ª–æ–±–±–∏. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ –≤ 4 —ç—Ç–∞–ø–∞.";
            }

            lobbies.forEach((size, index) => {
                const isPartial = size < 4;
                const lobbyDiv = document.createElement('div');
                lobbyDiv.className = `p-4 rounded-xl border-2 flex flex-col gap-2 ${isPartial ? 'border-amber-200 bg-amber-50' : 'border-stone-200 bg-white'}`;
                
                const title = document.createElement('div');
                title.className = 'font-bold text-stone-500 text-xs uppercase mb-1';
                title.textContent = isPartial && count === 10 ? '–†–æ—Ç–∞—Ü–∏—è / –û–∂–∏–¥–∞–Ω–∏–µ' : `–õ–æ–±–±–∏ ${index + 1}`;
                lobbyDiv.appendChild(title);

                const slotsDiv = document.createElement('div');
                slotsDiv.className = 'grid grid-cols-2 gap-2';
                
                for(let i=0; i<4; i++) {
                    const slot = document.createElement('div');
                    if (i < size) {
                        slot.className = 'h-8 bg-stone-200 rounded flex items-center justify-center text-xs font-bold text-stone-600';
                        slot.textContent = 'Team';
                    } else {
                        slot.className = 'h-8 border border-dashed border-stone-300 rounded flex items-center justify-center text-xs text-stone-400';
                        slot.textContent = '–ü—É—Å—Ç–æ';
                    }
                    slotsDiv.appendChild(slot);
                }
                lobbyDiv.appendChild(slotsDiv);
                lobbyGrid.appendChild(lobbyDiv);
            });

            formatExplanation.textContent = message;
        }

        teamSelect.addEventListener('change', updateLobbyViz);

        // --- Constants & Data ---
        // –ò–º–µ–Ω–∞ –¥–ª—è –∞–Ω—Ç—É—Ä–∞–∂–∞
        const TEAM_NAMES = [
            "Alpha Squad", "Beta Rushers", "Gamma Ghouls", "Delta Force",
            "Echo Base", "Fox Trot", "Golden Lions", "Heavy Metal",
            "Iron Wall", "Jade Dragons", "Kilo Watts", "Lunar Tide",
            "Mystic Arts", "Neon Riders", "Omega Point", "Phantom Ops"
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)
        let teamsData = [];

        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏ –±–∞–ª–ª—ã (Default values)
        const POINTS = { 1: 4, 2: 3, 3: 2, 4: 1 };
        const COEFS = { 1: 1.0, 2: 1.2, 3: 1.4, 4: 1.6 };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        function initTeams() {
            teamsData = TEAM_NAMES.map((name, index) => ({
                id: index,
                name: name,
                r1: 4, r2: 4, r3: 4, r4: 4, // Default ranks (last place)
                total: 0
            }));
            // –†–∞—Å–∫–∏–¥–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∏–Ω—Ç–µ—Ä–µ—Å–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            randomizeData();
        }

        function randomizeData() {
            teamsData.forEach(team => {
                team.r1 = Math.floor(Math.random() * 4) + 1;
                team.r2 = Math.floor(Math.random() * 4) + 1;
                team.r3 = Math.floor(Math.random() * 4) + 1;
                team.r4 = Math.floor(Math.random() * 4) + 1;
            });
        }

        function calculateTotals() {
            teamsData.forEach(team => {
                const s1 = POINTS[team.r1] * COEFS[1];
                const s2 = POINTS[team.r2] * COEFS[2];
                const s3 = POINTS[team.r3] * COEFS[3];
                const s4 = POINTS[team.r4] * COEFS[4];
                team.total = parseFloat((s1 + s2 + s3 + s4).toFixed(1));
            });
        }

        // --- Rendering ---
        const tbody = document.getElementById('teams-table-body');
        
        function renderTable() {
            tbody.innerHTML = '';
            
            // –ù–∞—Ö–æ–¥–∏–º –ª–∏–¥–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            const maxScore = Math.max(...teamsData.map(t => t.total));

            teamsData.forEach((team, index) => {
                const tr = document.createElement('tr');
                tr.className = team.total === maxScore ? 'bg-amber-50' : 'hover:bg-stone-50 transition-colors';
                
                // Rank column (index + 1 because data is sorted)
                const rankCell = `<td class="font-bold text-stone-500">${index + 1}</td>`;
                
                // Name column
                const nameCell = `<td class="font-medium ${team.total === maxScore ? 'text-amber-700' : 'text-stone-800'}">${team.name}</td>`;
                
                // Input helper
                const createSelect = (stage, val) => `
                    <select onchange="updateTeamRank(${team.id}, ${stage}, this.value)" 
                            class="rank-select ${val === 1 ? 'font-bold text-green-600 bg-green-50 border-green-200' : ''} 
                                               ${val === 4 ? 'text-red-400' : ''}">
                        <option value="1" ${val === 1 ? 'selected' : ''}>1</option>
                        <option value="2" ${val === 2 ? 'selected' : ''}>2</option>
                        <option value="3" ${val === 3 ? 'selected' : ''}>3</option>
                        <option value="4" ${val === 4 ? 'selected' : ''}>4</option>
                    </select>
                `;

                const cells = [
                    createSelect(1, team.r1),
                    createSelect(2, team.r2),
                    createSelect(3, team.r3),
                    createSelect(4, team.r4)
                ];

                const totalCell = `<td class="text-right font-bold ${team.total === maxScore ? 'text-amber-600 text-lg' : ''}">${team.total}</td>`;

                tr.innerHTML = rankCell + nameCell + 
                               cells.map((c, i) => `<td class="p-1 ${i===3 ? 'bg-amber-50/50' : ''}">${c}</td>`).join('') + 
                               totalCell;
                tbody.appendChild(tr);
            });
        }

        // --- Actions ---
        window.updateTeamRank = function(id, stage, value) {
            // Find team in array (unsorted logic needs ID lookup because order changes)
            // –ù–æ –º—ã —Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å–∞–º –º–∞—Å—Å–∏–≤, —Ç–∞–∫ —á—Ç–æ –Ω–∞–¥–æ –Ω–∞–π—Ç–∏ –ø–æ ID
            const team = teamsData.find(t => t.id === id);
            if (team) {
                team[`r${stage}`] = parseInt(value);
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ—Ç–∞–ª—ã, –Ω–æ –ù–ï —Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã —Å—Ç—Ä–æ–∫–∞ –Ω–µ —É–±–µ–∂–∞–ª–∞ –∏–∑-–ø–æ–¥ –º—ã—à–∫–∏
                calculateTotals();
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ—Ç–∞–ª –≤ DOM (—É–ø—Ä–æ—â–µ–Ω–Ω–æ - –ø–µ—Ä–µ—Ä–∏—Å—É–µ–º —Ç–∞–±–ª–∏—Ü—É –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ —Å –Ω–µ–π?)
                // –õ—É—á—à–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —Ç–æ—Ç–∞–ª–∞ –≤ —Å—Ç—Ä–æ–∫–µ, –∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –¥–µ–ª–∞—Ç—å –ø–æ –∫–Ω–æ–ø–∫–µ, –∏–Ω–∞—á–µ –Ω–µ—É–¥–æ–±–Ω–æ.
                updateChart();
                renderTable(); // Re-render to show updated total instantly (row might jump if we sorted constantly, but let's decide behavior)
            }
        };

        window.updateAndSort = function() {
            calculateTotals();
            // Sort Descending
            teamsData.sort((a, b) => b.total - a.total);
            renderTable();
            updateChart();
        };

        window.randomizeResults = function() {
            randomizeData();
            updateAndSort();
        };

        // --- Chart ---
        let chartInstance = null;

        function updateChart() {
            const ctx = document.getElementById('scoringChart').getContext('2d');
            const labels = teamsData.map(t => t.name); // Already sorted if updateAndSort called
            const data = teamsData.map(t => t.total);

            if (chartInstance) {
                chartInstance.data.labels = labels;
                chartInstance.data.datasets[0].data = data;
                chartInstance.update();
            } else {
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '–ë–∞–ª–ª—ã',
                            data: data,
                            backgroundColor: 'rgba(217, 119, 6, 0.6)', // amber-600
                            borderColor: 'rgba(217, 119, 6, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y', // Horizontal Bar Chart is better for 16 names
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { beginAtZero: true }
                        }
                    }
                });
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initTeams();
            calculateTotals();
            teamsData.sort((a, b) => b.total - a.total); // Initial Sort
            renderTable();
            updateChart();
            updateLobbyViz(); // Init Lobby Viz
        });

    </script>
</body>
</html>
