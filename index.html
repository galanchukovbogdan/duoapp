<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä: –ó–∞–≥—Ä—É–∑–∫–∞...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .chart-container { position: relative; width: 100%; height: 300px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #f5f5f4; color: #44403c; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .accent-bg { background-color: #d97706; }
        .accent-text { color: #d97706; }
        .sim-table th { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #78716c; font-weight: 600; padding: 0.5rem; }
        .sim-table td { padding: 0.25rem; }
        .rank-select { width: 100%; min-width: 40px; padding: 2px; font-size: 0.875rem; border-radius: 0.25rem; border: 1px solid #d6d3d1; background-color: #fff; text-align: center; }
        .rank-select:focus { outline: none; border-color: #d97706; }
        html { scroll-behavior: smooth; }
        @keyframes subtle-pulse {
            0% { box-shadow: 0 0 0 0 rgba(217, 119, 6, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(217, 119, 6, 0); }
            100% { box-shadow: 0 0 0 0 rgba(217, 119, 6, 0); }
        }
        .animate-subtle-pulse { animation: subtle-pulse 2s infinite; }
        .discord-float { position: fixed; bottom: 20px; right: 20px; z-index: 40; transition: all 0.3s ease; }
        .discord-float:hover { transform: scale(1.1); }
        
        /* Styles for Spoiler/Details */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: slideDown 0.3s ease-in-out; }
        @keyframes slideDown { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Floating Discord Button -->
    <a id="discord-float-link" href="#" target="_blank" class="discord-float bg-[#5865F2] text-white p-3 rounded-full shadow-lg flex items-center gap-2 hover:bg-[#4752C4] group">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.085 2.176 2.419 0 1.334-.966 2.419-2.176 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.085 2.176 2.419 0 1.334-.966 2.419-2.176 2.419z"/></svg>
        <span class="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 whitespace-nowrap text-sm font-bold">–ß–∞—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
    </a>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-sm border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center gap-2">
                    <span id="nav-title" class="font-bold text-xl tracking-tight text-stone-800">üèÜ ...</span>
                    <span id="nav-spots" class="hidden sm:inline-block bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded-full font-bold">
                        ...
                    </span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <button onclick="scrollToSection('about')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–û —Ç—É—Ä–Ω–∏—Ä–µ</button>
                    <button onclick="scrollToSection('format')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–§–æ—Ä–º–∞—Ç</button>
                    <button onclick="scrollToSection('scoring')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–†–µ–π—Ç–∏–Ω–≥</button>
                    <button onclick="scrollToSection('join')" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">–£—á–∞—Å—Ç–∏–µ</button>
                </div>
                <button onclick="openRegModal()" class="accent-bg text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-amber-700 transition-colors shadow-md animate-subtle-pulse">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-stone-900 text-stone-50 overflow-hidden">
        <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <div class="relative max-w-5xl mx-auto px-4 py-16 sm:px-6 lg:px-8 flex flex-col items-center text-center">
            
            <div class="inline-block bg-white/10 backdrop-blur-md px-4 py-1 rounded-full text-amber-400 font-bold text-sm mb-4 border border-amber-500/30">
                <span id="hero-date-badge">üî¥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç—ã...</span>
            </div>

            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4">
                <span id="hero-title-prefix"></span> <span id="hero-title-main" class="text-amber-500"></span>
            </h1>
            <p id="hero-subtitle" class="mt-2 max-w-2xl text-xl text-stone-300 mb-8">
                ...
            </p>

            <!-- Countdown Timer -->
            <div class="grid grid-cols-4 gap-4 mb-10 text-center">
                <div class="bg-stone-800/80 p-3 rounded-lg border border-stone-700 min-w-[70px]">
                    <div id="days" class="text-2xl md:text-3xl font-bold text-white">-</div>
                    <div class="text-[10px] text-stone-400 uppercase">–î–Ω—è</div>
                </div>
                <div class="bg-stone-800/80 p-3 rounded-lg border border-stone-700 min-w-[70px]">
                    <div id="hours" class="text-2xl md:text-3xl font-bold text-white">-</div>
                    <div class="text-[10px] text-stone-400 uppercase">–ß–∞—Å–∞</div>
                </div>
                <div class="bg-stone-800/80 p-3 rounded-lg border border-stone-700 min-w-[70px]">
                    <div id="minutes" class="text-2xl md:text-3xl font-bold text-white">-</div>
                    <div class="text-[10px] text-stone-400 uppercase">–ú–∏–Ω</div>
                </div>
                <div class="bg-stone-800/80 p-3 rounded-lg border border-stone-700 min-w-[70px]">
                    <div id="seconds" class="text-2xl md:text-3xl font-bold text-amber-500">-</div>
                    <div class="text-[10px] text-stone-400 uppercase">–°–µ–∫</div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 w-full justify-center">
                <button onclick="openRegModal()" class="accent-bg text-white px-8 py-4 rounded-xl text-lg font-bold hover:bg-amber-700 transition-all shadow-lg transform hover:scale-105">
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
                </button>
                <button onclick="scrollToSection('about')" class="bg-stone-800 text-stone-200 border border-stone-600 px-8 py-4 rounded-xl text-lg font-medium hover:bg-stone-700 transition-all">
                    –£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
                </button>
            </div>
        </div>
    </header>

    <!-- NEW: Discord Teammate Finder Section -->
    <section class="py-8 bg-blue-50 border-b border-blue-100">
        <div class="max-w-4xl mx-auto px-4 flex flex-col md:flex-row items-center justify-between gap-6">
            <div class="flex items-start gap-4">
                <div class="bg-blue-100 p-3 rounded-full hidden sm:block">
                    <svg class="w-8 h-8 text-[#5865F2]" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-stone-900">–ù–µ—Ç –∫–æ–º–∞–Ω–¥—ã? –ù–µ –ø—Ä–æ–±–ª–µ–º–∞!</h3>
                    <p class="text-stone-600 text-sm">–í –Ω–∞—à–µ–º Discord –≤ –∫–∞–Ω–∞–ª–µ <span class="font-mono bg-white px-1 rounded border border-blue-200">#–ø–æ–∏—Å–∫-–ø–∞—Ç–∏</span> –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏—â—É—Ç –∏–≥—Ä–æ–∫–æ–≤.</p>
                </div>
            </div>
            <a id="discord-section-link" href="#" target="_blank" class="w-full md:w-auto text-center px-6 py-3 bg-[#5865F2] hover:bg-[#4752C4] text-white font-bold rounded-lg transition-colors shadow-md flex items-center justify-center gap-2">
                <span>–ù–∞–π—Ç–∏ —Ç–∏–º–º–µ–π—Ç–æ–≤</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </a>
        </div>
    </section>

    <!-- Interactive Format Section -->
    <section id="format" class="py-16 bg-stone-100 border-y border-stone-200">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-stone-900 mb-4">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π?</h2>
                <p class="text-stone-600 mb-6">
                    –ì–ª–∞–≤–Ω–∞—è ¬´—Ñ–∏—à–∫–∞¬ª ‚Äî –≥–∏–±–∫–æ—Å—Ç—å. –ú—ã –∏–≥—Ä–∞–µ–º 3‚Äì4 —ç—Ç–∞–ø–∞. –í –∫–∞–∂–¥–æ–º —Ä–∞—É–Ω–¥–µ –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–±–±–∏ –∏–∑ 4-—Ö –∫–æ–º–∞–Ω–¥.
                    <br><br>
                    <strong>–ë–æ–∏—Ç–µ—Å—å "–Ω–µ—á–µ—Ç–Ω–æ–≥–æ" –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–∞–Ω–¥?</strong> –ù–µ —Å—Ç–æ–∏—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∏–º—É–ª—è—Ç–æ—Ä –Ω–∏–∂–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —Å–µ—Ç–∫—É –ø–æ–¥ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
                </p>
            </div>
            <!-- Format Visualizer -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                 <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <label for="team-count" class="font-bold text-stone-700 mr-4 mb-2 sm:mb-0">
                        –°–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å?
                    </label>
                    <select id="team-count" class="bg-stone-50 border border-stone-300 text-stone-900 text-sm rounded-lg focus:ring-amber-500 focus:border-amber-500 block p-2.5">
                        <option value="16" selected>16 –ö–æ–º–∞–Ω–¥ (–ü–æ–ª–Ω–∞—è —Å–µ—Ç–∫–∞)</option>
                        <option value="12">12 –ö–æ–º–∞–Ω–¥</option>
                        <option value="10">10 –ö–æ–º–∞–Ω–¥</option>
                        <option value="8">8 –ö–æ–º–∞–Ω–¥</option>
                    </select>
                </div>
                <div id="lobby-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 transition-all duration-500 ease-in-out">
                    <!-- Dynamic Content will appear here -->
                </div>
                <div id="format-explanation" class="mt-6 p-4 bg-blue-50 text-blue-800 rounded-lg text-sm border border-blue-100 flex items-start">
                    <span class="text-xl mr-3">‚ÑπÔ∏è</span>
                    <p>–¢–µ–∫—Å—Ç –ø–æ—è—Å–Ω–µ–Ω–∏—è...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Scoring Section: Live + Simulator -->
    <section id="scoring" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-stone-900">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è –¢–∞–±–ª–∏—Ü–∞</h2>
                <p class="text-stone-600 max-w-2xl mx-auto">
                    –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞.
                </p>
            </div>

            <!-- LIVE STANDINGS (NEW) -->
            <div class="bg-white p-6 rounded-2xl border-2 border-amber-100 shadow-xl mb-12 relative overflow-hidden">
                <div class="absolute top-0 right-0 bg-amber-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg">LIVE</div>
                <h3 class="font-bold text-lg text-stone-800 mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                    –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –†–µ–π—Ç–∏–Ω–≥
                </h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-left sim-table">
                        <thead>
                            <tr class="border-b border-stone-200">
                                <th class="w-8">#</th>
                                <th>–ö–æ–º–∞–Ω–¥–∞</th>
                                <th class="text-center w-16">–≠—Ç 1</th>
                                <th class="text-center w-16">–≠—Ç 2</th>
                                <th class="text-center w-16">–≠—Ç 3</th>
                                <th class="text-center w-16 text-amber-700 bg-amber-50">–≠—Ç 4</th>
                                <th class="text-right w-20">–í—Å–µ–≥–æ</th>
                            </tr>
                        </thead>
                        <tbody id="live-table-body" class="text-sm text-stone-700 divide-y divide-stone-100">
                            <!-- Live rows will be injected here -->
                            <tr><td colspan="7" class="text-center py-4 text-stone-400 italic">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SIMULATOR (SPOILER) -->
            <details class="group bg-stone-50 rounded-2xl border border-stone-200 overflow-hidden transition-all duration-300">
                <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-stone-100 transition-colors select-none">
                    <div class="flex flex-col">
                        <span class="font-bold text-lg text-stone-800">üõ† –°–∏–º—É–ª—è—Ç–æ—Ä (–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–∏)</span>
                        <span class="text-sm text-stone-500">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ —à–∞–Ω—Å—ã</span>
                    </div>
                    <span class="transform transition-transform group-open:rotate-180 text-stone-400">‚ñº</span>
                </summary>

                <div class="p-6 border-t border-stone-200">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                        <!-- Table Controls & Input -->
                        <div class="lg:col-span-2 overflow-hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-sm text-stone-800 uppercase tracking-wide">–ü–µ—Å–æ—á–Ω–∏—Ü–∞</h3>
                                <div class="flex gap-2">
                                    <button onclick="randomizeResults()" class="text-xs bg-stone-200 hover:bg-stone-300 text-stone-700 px-3 py-1 rounded transition-colors">
                                        üé≤ –°–ª—É—á–∞–π–Ω–æ
                                    </button>
                                    <button onclick="updateAndSort()" class="text-xs bg-amber-600 hover:bg-amber-700 text-white px-3 py-1 rounded transition-colors shadow-sm">
                                        üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
                                    </button>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="w-full text-left sim-table">
                                    <thead>
                                        <tr class="border-b border-stone-200">
                                            <th class="w-8">#</th>
                                            <th>–ö–æ–º–∞–Ω–¥–∞</th>
                                            <th class="text-center w-16">–≠—Ç 1</th>
                                            <th class="text-center w-16">–≠—Ç 2</th>
                                            <th class="text-center w-16">–≠—Ç 3</th>
                                            <th class="text-center w-16 text-amber-700 bg-amber-50">–≠—Ç 4</th>
                                            <th class="text-right w-20">–ò—Ç–æ–≥</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teams-table-body" class="text-sm text-stone-700 divide-y divide-stone-100">
                                        <!-- Sim Rows generated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Chart & Stats -->
                        <div class="bg-white p-4 rounded-xl border border-stone-200 shadow-sm">
                            <h3 class="font-bold text-stone-800 mb-4 text-center text-sm">–ì—Ä–∞—Ñ–∏–∫ –°–∏–º—É–ª—è—Ü–∏–∏</h3>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="scoringChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </details>
        </div>
    </section>

    <!-- Prizes & Join Section (–Ø–ö–û–†–¨ #join) -->
    <section id="join" class="py-16 bg-stone-900 text-stone-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            
            <div class="bg-gradient-to-br from-amber-600 to-amber-700 rounded-3xl p-8 md:p-12 shadow-2xl">
                <h2 class="text-3xl font-bold text-white mb-8">–ì–æ—Ç–æ–≤—ã –ø–æ–±–µ–∂–¥–∞—Ç—å?</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-left mb-10">
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md hover:bg-white/20 transition cursor-pointer">
                        <span class="block text-2xl font-bold opacity-50 mb-1">01</span>
                        <h4 class="font-bold">Discord</h4>
                        <a id="discord-card-link" href="#" target="_blank" class="text-xs opacity-80 underline hover:text-white">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</a>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md">
                        <span class="block text-2xl font-bold opacity-50 mb-1">02</span>
                        <h4 class="font-bold">–°–æ—Å—Ç–∞–≤</h4>
                        <p class="text-xs opacity-80">–ù–∞–π–¥–∏—Ç–µ 2-5 –∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–∞–ø–∏—Ç–∞–Ω–∞.</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md">
                        <span class="block text-2xl font-bold opacity-50 mb-1">03</span>
                        <h4 class="font-bold">–ó–∞—è–≤–∫–∞</h4>
                        <p class="text-xs opacity-80">–ö–∞–ø–∏—Ç–∞–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∑–∞ 2 –º–∏–Ω—É—Ç—ã.</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg backdrop-blur-md">
                        <span class="block text-2xl font-bold opacity-50 mb-1">04</span>
                        <h4 class="font-bold">–°—Ç–∞—Ä—Ç</h4>
                        <p class="text-xs opacity-80">–ë—É–¥—å—Ç–µ –æ–Ω–ª–∞–π–Ω –∑–∞ 30 –º–∏–Ω –¥–æ –Ω–∞—á–∞–ª–∞.</p>
                    </div>
                </div>

                <!-- POPUP TRIGGER BUTTON -->
                <button onclick="openRegModal()" class="inline-block w-full md:w-auto bg-white text-amber-700 px-8 py-4 rounded-xl text-lg font-bold hover:bg-stone-100 transition-colors shadow-lg transform hover:scale-105 cursor-pointer">
                    –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—á–∞—Å—Ç–∏–µ
                </button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-8 border-t border-stone-800 mt-auto">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <p id="footer-text" class="mb-2">¬© 2023 [–¢–£–†–ù–ò–†].</p>
        </div>
    </footer>

    <!-- REGISTRATION MODAL (POPUP) -->
    <div id="regModal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- Backdrop (Dark overlay) -->
        <div class="fixed inset-0 bg-stone-900 bg-opacity-90 transition-opacity backdrop-blur-sm" onclick="closeRegModal()"></div>

        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-0 md:p-4 text-center">
                <!-- Modal Panel -->
                <div class="relative transform overflow-hidden rounded-none md:rounded-2xl bg-white text-left shadow-2xl transition-all w-full h-full md:h-auto md:w-full md:max-w-4xl flex flex-col">
                    
                    <!-- Header with Close Button -->
                    <div class="bg-stone-50 px-4 py-3 border-b border-stone-200 flex justify-between items-center">
                        <h3 class="text-base font-semibold leading-6 text-stone-900">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã</h3>
                        <button type="button" onclick="closeRegModal()" class="rounded-md bg-stone-100 p-1 text-stone-500 hover:text-stone-700 focus:outline-none hover:bg-stone-200 transition-colors">
                            <span class="sr-only">–ó–∞–∫—Ä—ã—Ç—å</span>
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Iframe Container -->
                    <div class="bg-white flex-grow h-[85vh] md:h-[80vh] w-full relative">
                        <iframe id="google-form-iframe" src="" 
                                class="absolute inset-0 w-full h-full border-none" 
                                frameborder="0" marginheight="0" marginwidth="0">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // --- CONSTANTS ---
        const POINTS = { 1: 4, 2: 3, 3: 2, 4: 1, 0: 0 }; // 0 if not played
        const COEFS = { 1: 1.0, 2: 1.2, 3: 1.4, 4: 1.6 };

        // --- 1. CONFIG LOADER ---
        let tournamentConfig = null;

        async function loadConfig() {
            try {
                // Add timestamp to prevent caching
                const response = await fetch('config.json?v=' + new Date().getTime());
                if (!response.ok) throw new Error("Config not found");
                
                const config = await response.json();
                tournamentConfig = config;
                applyConfig(config);
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞:", error);
                document.getElementById('live-table-body').innerHTML = `<tr><td colspan="7" class="text-center py-4 text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.json</td></tr>`;
            }
        }

        function applyConfig(cfg) {
            // Basic Info
            document.title = `${cfg.tournamentName} - ${cfg.seasonName}`;
            document.getElementById('nav-title').textContent = cfg.tournamentName;
            document.getElementById('nav-spots').textContent = `${cfg.messages.spotsAlert} ${cfg.status.spotsLeft}`;
            document.getElementById('hero-title-prefix').textContent = cfg.messages.heroTitle;
            document.getElementById('hero-title-main').textContent = cfg.tournamentName;
            document.getElementById('hero-subtitle').textContent = cfg.messages.heroSubtitle;
            document.getElementById('footer-text').textContent = `¬© ${new Date().getFullYear()} ${cfg.tournamentName}`;
            document.getElementById('hero-date-badge').textContent = `üî¥ ${cfg.eventDateText}`;

            // Links
            document.getElementById('discord-float-link').href = cfg.links.discord;
            document.getElementById('discord-section-link').href = cfg.links.discord;
            document.getElementById('discord-card-link').href = cfg.links.discord;
            document.getElementById('google-form-iframe').src = cfg.links.googleForm;

            // Timer
            startCountdown(cfg.status.deadlineIso);

            // Render LIVE Table
            if (cfg.teams && Array.isArray(cfg.teams)) {
                renderLiveStandings(cfg.teams);
            } else {
                document.getElementById('live-table-body').innerHTML = `<tr><td colspan="7" class="text-center py-4 text-stone-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–∞–Ω–¥–∞—Ö</td></tr>`;
            }
        }

        // --- 2. LIVE STANDINGS LOGIC ---
        function calculateScore(ranks) {
            // ranks: {r1: val, r2: val...}
            let total = 0;
            for(let i=1; i<=4; i++) {
                const rank = ranks[`r${i}`] || 0; // 0 if missing
                const pts = POINTS[rank] || 0;
                total += pts * COEFS[i];
            }
            return parseFloat(total.toFixed(1));
        }

        function renderLiveStandings(teamsRaw) {
            // Calculate totals for all teams
            const teamsWithScore = teamsRaw.map(t => {
                const total = calculateScore(t);
                return { ...t, total };
            });

            // Sort by Total Descending
            teamsWithScore.sort((a, b) => b.total - a.total);

            const tbody = document.getElementById('live-table-body');
            tbody.innerHTML = '';

            const maxScore = teamsWithScore.length > 0 ? teamsWithScore[0].total : 0;

            teamsWithScore.forEach((team, index) => {
                const tr = document.createElement('tr');
                tr.className = team.total === maxScore && maxScore > 0 ? 'bg-amber-50 font-medium' : 'hover:bg-stone-50 transition-colors';
                
                // Helper to render rank cell (dash if 0)
                const rankVal = (r) => r && r > 0 ? r : '-';

                tr.innerHTML = `
                    <td class="font-bold text-stone-500">${index + 1}</td>
                    <td class="text-stone-800">${team.name}</td>
                    <td class="text-center text-stone-500">${rankVal(team.r1)}</td>
                    <td class="text-center text-stone-500">${rankVal(team.r2)}</td>
                    <td class="text-center text-stone-500">${rankVal(team.r3)}</td>
                    <td class="text-center text-amber-700 bg-amber-50/50">${rankVal(team.r4)}</td>
                    <td class="text-right font-bold ${team.total === maxScore && maxScore > 0 ? 'text-amber-600' : 'text-stone-800'}">${team.total}</td>
                `;
                tbody.appendChild(tr);
            });
        }


        // --- 3. COUNTDOWN LOGIC ---
        let timerInterval;

        function startCountdown(deadlineIso) {
            if (timerInterval) clearInterval(timerInterval);

            function update() {
                const now = new Date();
                const targetDate = new Date(deadlineIso);
                const diff = targetDate - now;

                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    document.getElementById('days').innerText = days < 10 ? '0' + days : days;
                    document.getElementById('hours').innerText = hours < 10 ? '0' + hours : hours;
                    document.getElementById('minutes').innerText = minutes < 10 ? '0' + minutes : minutes;
                    document.getElementById('seconds').innerText = seconds < 10 ? '0' + seconds : seconds;
                } else {
                    document.getElementById('seconds').innerText = "00";
                }
            }
            timerInterval = setInterval(update, 1000);
            update();
        }

        // --- 4. SIMULATOR LOGIC (Separate from Live) ---
        const SIM_NAMES = ["Alpha", "Beta", "Gamma", "Delta", "Echo", "Fox", "Gold", "Heavy", "Iron", "Jade", "Kilo", "Luna", "Mystic", "Neon", "Omega", "Phantom"];
        let simTeamsData = [];

        function initSimTeams() {
            simTeamsData = SIM_NAMES.map((name, index) => ({
                id: index, name: name, r1: 4, r2: 4, r3: 4, r4: 4, total: 0
            }));
            randomizeData();
        }

        function randomizeData() {
            simTeamsData.forEach(team => {
                team.r1 = Math.floor(Math.random() * 4) + 1;
                team.r2 = Math.floor(Math.random() * 4) + 1;
                team.r3 = Math.floor(Math.random() * 4) + 1;
                team.r4 = Math.floor(Math.random() * 4) + 1;
            });
        }

        function calculateSimTotals() {
            simTeamsData.forEach(team => {
                // Reusing the same calculateScore logic, but passing constructed object
                team.total = calculateScore({r1: team.r1, r2: team.r2, r3: team.r3, r4: team.r4});
            });
        }

        const simTbody = document.getElementById('teams-table-body');
        function renderSimTable() {
            simTbody.innerHTML = '';
            const maxScore = Math.max(...simTeamsData.map(t => t.total));
            simTeamsData.forEach((team, index) => {
                const tr = document.createElement('tr');
                tr.className = team.total === maxScore ? 'bg-amber-50' : 'hover:bg-stone-50';
                const createSelect = (s, v) => `<select onchange="updateTeamRank(${team.id}, ${s}, this.value)" class="rank-select"><option value="1" ${v==1?'selected':''}>1</option><option value="2" ${v==2?'selected':''}>2</option><option value="3" ${v==3?'selected':''}>3</option><option value="4" ${v==4?'selected':''}>4</option></select>`;
                tr.innerHTML = `<td class="font-bold text-stone-500">${index+1}</td><td class="font-medium">${team.name}</td><td>${createSelect(1,team.r1)}</td><td>${createSelect(2,team.r2)}</td><td>${createSelect(3,team.r3)}</td><td class="bg-amber-50/50">${createSelect(4,team.r4)}</td><td class="text-right font-bold">${team.total}</td>`;
                simTbody.appendChild(tr);
            });
        }

        window.updateTeamRank = function(id, stage, value) {
            const team = simTeamsData.find(t => t.id === id);
            if (team) { team[`r${stage}`] = parseInt(value); calculateSimTotals(); updateChart(); renderSimTable(); }
        };

        window.updateAndSort = function() { calculateSimTotals(); simTeamsData.sort((a, b) => b.total - a.total); renderSimTable(); updateChart(); };
        window.randomizeResults = function() { randomizeData(); updateAndSort(); };

        let chartInstance = null;
        function updateChart() {
            const ctx = document.getElementById('scoringChart').getContext('2d');
            const data = simTeamsData.map(t => t.total);
            if (chartInstance) { chartInstance.data.datasets[0].data = data; chartInstance.update(); } 
            else {
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: simTeamsData.map(t => t.name), datasets: [{ label: '–ë–∞–ª–ª—ã', data: data, backgroundColor: 'rgba(217, 119, 6, 0.6)' }] },
                    options: { indexAxis: 'y', maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });
            }
        }


        // --- INIT ALL ---
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig(); 

            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready(); 
                tg.expand(); 
            }
            updateLobbyViz();
            
            // Init Sim
            initSimTeams();
            updateAndSort();
        });

        // --- Navigation Logic ---
        function scrollToSection(id) {
            const element = document.getElementById(id);
            if (element) { element.scrollIntoView({ behavior: 'smooth' }); }
        }

        // --- Modal Logic ---
        function openRegModal() {
            document.getElementById('regModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeRegModal() {
            document.getElementById('regModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // --- Format Visualizer Logic ---
        const teamSelect = document.getElementById('team-count');
        const lobbyGrid = document.getElementById('lobby-grid');
        const formatExplanation = document.getElementById('format-explanation').querySelector('p');

        function updateLobbyViz() {
            const count = parseInt(teamSelect.value);
            lobbyGrid.innerHTML = '';
            
            let lobbies = [];
            let message = '';

            if (count === 8) { lobbies = [4, 4]; message = "2 –ø–æ–ª–Ω—ã—Ö –ª–æ–±–±–∏. –ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å."; } 
            else if (count === 10) { lobbies = [4, 4, 2]; message = "10 –∫–æ–º–∞–Ω–¥: 2 –ø–æ–ª–Ω—ã—Ö –ª–æ–±–±–∏ + —Ä–æ—Ç–∞—Ü–∏—è."; } 
            else if (count === 12) { lobbies = [4, 4, 4]; message = "12 –∫–æ–º–∞–Ω–¥: 3 –ø–æ–ª–Ω—ã—Ö –ª–æ–±–±–∏."; } 
            else if (count === 16) { lobbies = [4, 4, 4, 4]; message = "16 –∫–æ–º–∞–Ω–¥: –ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç."; }

            lobbies.forEach((size, index) => {
                const isPartial = size < 4;
                const lobbyDiv = document.createElement('div');
                lobbyDiv.className = `p-4 rounded-xl border-2 flex flex-col gap-2 ${isPartial ? 'border-amber-200 bg-amber-50' : 'border-stone-200 bg-white'}`;
                
                const title = document.createElement('div');
                title.className = 'font-bold text-stone-500 text-xs uppercase mb-1';
                title.textContent = isPartial && count === 10 ? '–†–æ—Ç–∞—Ü–∏—è' : `–õ–æ–±–±–∏ ${index + 1}`;
                lobbyDiv.appendChild(title);

                const slotsDiv = document.createElement('div');
                slotsDiv.className = 'grid grid-cols-2 gap-2';
                
                for(let i=0; i<4; i++) {
                    const slot = document.createElement('div');
                    if (i < size) {
                        slot.className = 'h-8 bg-stone-200 rounded flex items-center justify-center text-xs font-bold text-stone-600';
                        slot.textContent = 'Team';
                    } else {
                        slot.className = 'h-8 border border-dashed border-stone-300 rounded flex items-center justify-center text-xs text-stone-400';
                        slot.textContent = '...';
                    }
                    slotsDiv.appendChild(slot);
                }
                lobbyDiv.appendChild(slotsDiv);
                lobbyGrid.appendChild(lobbyDiv);
            });

            formatExplanation.textContent = message;
        }
        teamSelect.addEventListener('change', updateLobbyViz);

    </script>
</body>
</html>
